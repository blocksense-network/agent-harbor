# Copyright 2025 Schelling Point Labs Inc
# SPDX-License-Identifier: AGPL-3.0-only

name: timing_test_scenario
description: "Scenario for testing SSE event timing verification"
tags: ["test", "timing"]
repo:
  init: true
  files:
    - path: "README.md"
      contents: |
        # Timing Test Scenario

        Used to verify that SSE events are streamed with correct timing.
timeline:
  # Start with thinking events at specific times
  - think:
      - [500, "Starting timing test scenario"]
      - [300, "Analyzing timing requirements"]

  # First tool execution after 800ms total thinking time
  - agentToolUse:
      toolName: "run_command"
      args:
        command: "echo 'Timing test started'"
        cwd: "."
      progress:
        - [100, "Preparing timing test..."]
        - [200, "Running timing verification..."]
      result: "Timing test started"
      status: "ok"

  # File edit event
  - agentEdits:
      path: "timing_test.txt"
      linesAdded: 3
      linesRemoved: 0

  # More thinking
  - think:
      - [400, "Processing timing results"]
      - [200, "Preparing final verification"]

  # Final tool execution
  - agentToolUse:
      toolName: "run_command"
      args:
        command: "echo 'Timing test completed'"
        cwd: "."
      progress:
        - [150, "Finalizing timing test..."]
      result: "Timing test completed"
      status: "ok"

  # Mark scenario as complete and merge to keep in session listings
  - complete: true
  - merge: true

expect:
  exitCode: 0
  artifacts:
    - type: "taskFile"
      pattern: "README.md"
    - type: "taskFile"
      pattern: "timing_test.txt"
