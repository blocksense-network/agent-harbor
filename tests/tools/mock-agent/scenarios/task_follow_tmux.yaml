# Copyright 2025 Schelling Point Labs Inc
# SPDX-License-Identifier: AGPL-3.0-only

name: task_follow_tmux
repo:
  init: true
  commit: true
timeline:
  - userCommand:
      program: bash
      env:
        AH_BIN: ${AH_BIN:-}
      args:
        - -lc
        - "set -euo pipefail\nif [ -z \"${AH_BIN:-}\" ]; then\n  echo \"AH_BIN not set\"\
          \ >&2\n  exit 1\nfi\nSOCKET=\"$(mktemp -u /tmp/ah-tmux-XXXXXX)\"\nLOG=\"${SOCKET}.log\"\
          \n# Launch follow in a dedicated tmux session so we can capture pane output\n\
          tmux -S \"$SOCKET\" new-session -d -s ah \"$AH_BIN task create tmux-follow --prompt\
          \ 'verify follow renders in tmux' --model mock --push-to-remote false --non-interactive\
          \ --follow\"\n# Give it a moment to render\nsleep 5\ntmux -S \"$SOCKET\" capture-pane\
          \ -pt ah > \"$LOG\"\ntmux -S \"$SOCKET\" kill-session -t ah || true\ngrep -qi\
          \ \"verify follow renders\" \"$LOG\"\n"
      expect:
        exit_code: 0
